(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();class n{gl;program;positionBuffer;positionLocation;resolutionLocation;constructor(t){this.gl=t,this.program=this.createProgram(),this.positionBuffer=t.createBuffer(),this.positionLocation=t.getAttribLocation(this.program,"vertex_position"),this.resolutionLocation=t.getUniformLocation(this.program,"canva_size")}createProgram(){const t=`
            attribute vec2 vertex_position;
            uniform vec2 canva_size;
            void main() {
                vec2 normalized_position = vertex_position / canva_size;
                vec2 clip_space_position = normalized_position * 2.0 - 1.0;
                gl_Position = vec4(clip_space_position * vec2(1.0, -1.0), 0.0, 1.0);
            }
        `,s=`
            void main() {
                gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
            }
        `,e=this.createShader(this.gl.VERTEX_SHADER,t),i=this.createShader(this.gl.FRAGMENT_SHADER,s),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,i),this.gl.linkProgram(r),r}createShader(t,s){const e=this.gl.createShader(t);return this.gl.shaderSource(e,s),this.gl.compileShader(e),e}clear(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}drawPlayer(t){this.drawHead(t),this.drawTorso(t),this.drawLegs(t)}drawHead({x:t,y:s,width:e,height:i}){this.drawRectangle({x:t+e*.5-e*.25,y:s,width:e*.5,height:i*.2})}drawTorso({x:t,y:s,width:e,height:i}){this.drawRectangle({x:t+e*.5-e*.5,y:s+i*.25,width:e,height:i*.4})}drawLegs({x:t,y:s,width:e,height:i}){this.drawRectangle({x:t+e*.5-e*.22,y:s+i*.25+i*.4,width:e*.2,height:i*.35}),this.drawRectangle({x:t+e*.5+e*.02,y:s+i*.25+i*.4,width:e*.2,height:i*.35})}drawRectangle(t){this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer);const{x:s,y:e,width:i,height:r}=t,o=new Float32Array([s,e,s+i,e,s,e+r,s,e+r,s+i,e,s+i,e+r]);this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.uniform2f(this.resolutionLocation,this.gl.canvas.width,this.gl.canvas.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}class l{onKeyDown=null;constructor(){window.addEventListener("keydown",t=>{this.onKeyDown&&this.onKeyDown(t.key)})}setOnKeyDown(t){this.onKeyDown=t}}class h{x;y;width;height;step;velocityY;onGround;health=100;strength=10;attackRange=20;constructor(t,s,e=60,i=150){this.x=t,this.y=s,this.width=e,this.height=i,this.step=10,this.velocityY=0,this.onGround=!0}moveLeft(){this.x-=this.step}moveRight(){this.x+=this.step}getRectangle(){return{x:this.x,y:this.y,width:this.width,height:this.height}}isInRange(t){return Math.abs(this.x+this.width-t.x)<=this.attackRange}attack(t){this.isInRange(t)&&(t.health-=this.strength)}}class c{canvas;webGL;input;player;player2;gravity=.5;jumpForce=-12;debug;constructor(t){const s=document.querySelector(t);if(!s)throw new Error("Cannot retrieve canvas element");const e=s.getContext("webgl");if(!e)throw new Error("WebGL is not supported");this.canvas=s,this.webGL=new n(e),this.input=new l,this.player=new h(50,50),this.player2=new h(s.width-150,50),this.debug=this.debugInfo(),this.keyboard(),this.loop()}debugInfo(){const t=document.createElement("pre");return t.style.position="absolute",t.style.left=`${this.canvas.offsetLeft+this.canvas.width+10}px`,t.style.top=`${this.canvas.offsetTop}px`,t.style.color="black",document.body.appendChild(t),t}debugUpdate(){this.debug.textContent=[this.player,this.player2].map((t,s)=>`
                Player ${s+1}:
                  x: ${t.x.toFixed(1)}
                  y: ${t.y.toFixed(1)}
                  width: ${t.width}
                  height: ${t.height}
                  velocityY: ${t.velocityY.toFixed(2)}
                  onGround: ${t.onGround}
                  health: ${t.health}
                  strength: ${t.strength}
            `).join()}loop(){this.setGravity(),this.render(),this.debugUpdate(),requestAnimationFrame(()=>this.loop())}setGravity(){[this.player,this.player2].map(t=>{t.velocityY+=this.gravity,t.y+=t.velocityY,t.y+t.height>=this.canvas.height&&(t.y=this.canvas.height-t.height,t.velocityY=0,t.onGround=!0)})}willCollide(t){return t<this.player2.x+this.player2.width&&t+this.player.width>this.player2.x}keyboard(){this.input.setOnKeyDown(t=>{switch(t){case"ArrowLeft":{const s=this.player.x-this.player.step;s>=0&&!this.willCollide(s)&&this.player.moveLeft();break}case"ArrowRight":{const s=this.player.x+this.player.step;s+this.player.width<=this.canvas.width&&!this.willCollide(s)&&this.player.moveRight();break}case"ArrowUp":this.player.onGround&&this.player.y-this.player.step>=0&&(this.player.velocityY=this.jumpForce,this.player.onGround=!1);break;case"a":this.player.attack(this.player2);break}this.render()})}render(){this.webGL.clear(),this.webGL.drawPlayer(this.player.getRectangle()),this.webGL.drawPlayer(this.player2.getRectangle())}}const d=new c("#glCanvas");d.render();
